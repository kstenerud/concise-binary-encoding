#include "test_helpers.h"

static inline __int128 i128(int64_t high, uint64_t low)
{
    return (((__int128)high) << 64) + low;
}

DEFINE_ENCODE_DECODE_ENCODE_TEST(Int128Test, _0,         (__int128)          0L, {0x00})
DEFINE_ENCODE_DECODE_ENCODE_TEST(Int128Test, _1,         (__int128)          1L, {0x01})
DEFINE_ENCODE_DECODE_ENCODE_TEST(Int128Test, _103,       (__int128)        103L, {0x67})
DEFINE_ENCODE_DECODE_ENCODE_TEST(Int128Test, _n1,        (__int128)         -1L, {0xff})
DEFINE_ENCODE_DECODE_ENCODE_TEST(Int128Test, _n104,      (__int128)       -104L, {0x98})
DEFINE_ENCODE_DECODE_ENCODE_TEST(Int128Test, _104,       (__int128)        104L, {TYPE_INT_16, 0x68, 0x00})
DEFINE_ENCODE_DECODE_ENCODE_TEST(Int128Test, _n105,      (__int128)       -105L, {TYPE_INT_16, 0x97, 0xff})
DEFINE_ENCODE_DECODE_ENCODE_TEST(Int128Test, _127,       (__int128)        127L, {TYPE_INT_16, 0x7f, 0x00})
DEFINE_ENCODE_DECODE_ENCODE_TEST(Int128Test, _n128,      (__int128)       -128L, {TYPE_INT_16, 0x80, 0xff})
DEFINE_ENCODE_DECODE_ENCODE_TEST(Int128Test, _7fff,      (__int128)     0x7fffL, {TYPE_INT_16, 0xff, 0x7f})
DEFINE_ENCODE_DECODE_ENCODE_TEST(Int128Test, _n8000,     (__int128)    -0x8000L, {TYPE_INT_16, 0x00, 0x80})
DEFINE_ENCODE_DECODE_ENCODE_TEST(Int128Test, _8000,      (__int128)     0x8000L, {TYPE_INT_32, 0x00, 0x80, 0x00, 0x00})
DEFINE_ENCODE_DECODE_ENCODE_TEST(Int128Test, _n8001,     (__int128)    -0x8001L, {TYPE_INT_32, 0xff, 0x7f, 0xff, 0xff})
DEFINE_ENCODE_DECODE_ENCODE_TEST(Int128Test, _7fffffff,  (__int128) 0x7fffffffL, {TYPE_INT_32, 0xff, 0xff, 0xff, 0x7f})
DEFINE_ENCODE_DECODE_ENCODE_TEST(Int128Test, _n80000000, (__int128)-0x80000000L, {TYPE_INT_32, 0x00, 0x00, 0x00, 0x80})
DEFINE_ENCODE_DECODE_ENCODE_TEST(Int128Test, _80000000,  (__int128) 0x80000000L, {TYPE_INT_64, 0x00, 0x00, 0x00, 0x80, 0x00, 0x00, 0x00, 0x00})
DEFINE_ENCODE_DECODE_ENCODE_TEST(Int128Test, _n80000001, (__int128)-0x80000001L, {TYPE_INT_64, 0xff, 0xff, 0xff, 0x7f, 0xff, 0xff, 0xff, 0xff})
DEFINE_ENCODE_DECODE_ENCODE_TEST(Int128Test, _7fffffffffffffff,  (__int128) 0x7fffffffffffffffL, {TYPE_INT_64, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0x7f})
DEFINE_ENCODE_DECODE_ENCODE_TEST(Int128Test, _n8000000000000000, (__int128)(int64_t)-0x8000000000000000L, {TYPE_INT_64, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x80})
DEFINE_ENCODE_DECODE_ENCODE_TEST(Int128Test, _10000000000000000,  i128(0x0000000000000001L, 0x0000000000000000L), {TYPE_INT_128, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x01, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00})
DEFINE_ENCODE_DECODE_ENCODE_TEST(Int128Test, _n10000000000000000,  i128(-0x0000000000000001L, 0x0000000000000000L), {TYPE_INT_128, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff})
DEFINE_ENCODE_DECODE_ENCODE_TEST(Int128Test, _7fffffffffffffffffffffffffffffff, i128(0x7fffffffffffffffL, 0xffffffffffffffffL), {TYPE_INT_128, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0x7f})
DEFINE_ENCODE_DECODE_ENCODE_TEST(Int128Test, _n80000000000000000000000000000000,  i128(-0x8000000000000000L, 0x0000000000000000L), {TYPE_INT_128, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x80})

DEFINE_FAILED_ADD_TEST(Int128Test, add_fail, 15, i128(0x7fffffffffffffffL, 0xffffffffffffffffL))
